<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  {%- capture seo_tags -%}
    {% seo title=false %}
  {%- endcapture -%}

  {% if page.image %}
    {% assign src = page.image.path | default: page.image %}

    {% unless src contains '://' %}
      {%- capture img_url -%}
        {% include media-url.html src=src subpath=page.media_subpath absolute=true %}
      {%- endcapture -%}

      {%- capture old_url -%}{{ src | absolute_url }}{%- endcapture -%}
      {%- capture new_url -%}{{ img_url }}{%- endcapture -%}

      {% assign seo_tags = seo_tags | replace: old_url, new_url %}
    {% endunless %}

  {% elsif site.social_preview_image %}
    {%- capture img_url -%}
      {% include media-url.html src=site.social_preview_image absolute=true %}
    {%- endcapture -%}

    {%- capture og_image -%}
      <meta property="og:image" content="{{ img_url }}" />
    {%- endcapture -%}

    {%- capture twitter_image -%}
      <meta name="twitter:card" content="summary_large_image" />
      <meta property="twitter:image" content="{{ img_url }}" />
    {%- endcapture -%}

    {% assign old_meta_clip = '<meta name="twitter:card" content="summary" />' %}
    {% assign new_meta_clip = og_image | append: twitter_image %}
    {% assign seo_tags = seo_tags | replace: old_meta_clip, new_meta_clip %}
  {% endif %}

  {{ seo_tags }}

  {%- if site.social.fediverse_handle %}
    <meta name="fediverse:creator" content="{{ site.social.fediverse_handle }}">
  {% endif %}

  <title>
    {%- unless page.layout == 'home' -%}
      {%- capture title -%}
        {%- if page.collection == 'tabs' -%}
          {%- assign tab_key = page.title | downcase -%}
          {{- site.data.locales[include.lang].tabs[tab_key] -}}
        {%- else -%}
          {{- page.title -}}
        {%- endif -%}
      {%- endcapture -%}
      {{- title | append: ' | ' -}}
    {%- endunless -%}
    {{- site.title -}}
  </title>

  {% include_cached favicons.html %}

  {% unless site.assets.self_host.enabled %}
    {% for hint in site.data.origin.cors.resource_hints %}
      {% for link in hint.links %}
        <link rel="{{ link.rel }}" href="{{ hint.url }}" {{ link.opts | join: ' ' }}>
      {% endfor %}
    {% endfor %}
  {% endunless %}

  {% unless jekyll.environment == 'production' %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  {% endunless %}

  <link rel="stylesheet" href="{{ '/assets/css/:THEME.css' | replace: ':THEME', site.theme | relative_url }}">

  <link rel="stylesheet" href="{{ site.data.origin[type].webfonts | relative_url }}">

  <link rel="stylesheet" href="{{ site.data.origin[type].fontawesome.css | relative_url }}">

  {% if site.toc and page.toc %}
    <link rel="stylesheet" href="{{ site.data.origin[type].toc.css | relative_url }}">
  {% endif %}

  {% if page.layout == 'post' or page.layout == 'page' or page.layout == 'home' %}
    <link rel="stylesheet" href="{{ site.data.origin[type]['lazy-polyfill'].css | relative_url }}">
  {% endif %}

  {% if page.layout == 'page' or page.layout == 'post' %}
    <link rel="stylesheet" href="{{ site.data.origin[type].glightbox.css | relative_url }}">
  {% endif %}

  <script src="{{ '/assets/js/dist/theme.min.js' | relative_url }}"></script>

  {% include js-selector.html lang=lang %}

  {% if jekyll.environment == 'production' %}
    {% if site.pwa.enabled %}
      <script
        defer
        src="{{ '/app.min.js' | relative_url }}?baseurl={{ site.baseurl | default: '' }}&register={{ site.pwa.cache.enabled }}"
      ></script>
    {% endif %}

    {% for analytics in site.analytics %}
      {% capture str %}{{ analytics }}{% endcapture %}
      {% assign platform = str | split: '{' | first %}
      {% if site.analytics[platform].id and site.analytics[platform].id != empty %}
        {% include analytics/{{ platform }}.html %}
      {% endif %}
    {% endfor %}
  {% endif %}

{% if site.user_custom_theme %}
  <style>
    /* 1. 웹폰트 Import */
    {% if site.user_custom_theme.font_import_url %}
      @import url('{{ site.user_custom_theme.font_import_url }}');
    {% endif %}

    /* 2. 전역 변수 설정 (라이트 모드 타겟팅 강화) */
    :root {
      {% if site.user_custom_theme.font_family_base %}
        --font-family-sans: {{ site.user_custom_theme.font_family_base }};
        --font-family-heading: var(--font-family-sans);
      {% endif %}
    }

    html[data-mode="light"] {
      /* --- Main Colors --- */
      {% if site.user_custom_theme.main_bg %}
        --body-bg: {{ site.user_custom_theme.main_bg }} !important;
        --main-wrapper-bg: {{ site.user_custom_theme.main_bg }} !important;
        --topbar-wrapper-bg: {{ site.user_custom_theme.main_bg }} !important;
        --search-wrapper-bg: {{ site.user_custom_theme.main_bg }} !important;
        --footer-bg: {{ site.user_custom_theme.main_bg }} !important;
        /* 카드형 레이아웃 배경색 (메인 배경과 맞춤) */
        --card-bg: {{ site.user_custom_theme.card_bg | default: site.user_custom_theme.main_bg }} !important;
      {% endif %}

      /* --- Text & Heading --- */
      {% if site.user_custom_theme.text_color %}
        --text-color: {{ site.user_custom_theme.text_color }} !important;
      {% endif %}

      {% if site.user_custom_theme.heading_color %}
        --heading-color: {{ site.user_custom_theme.heading_color }} !important;
        --title-color: {{ site.user_custom_theme.heading_color }} !important;
      {% endif %}

      /* --- Sidebar (Chirpy 특화 변수) --- */
      {% if site.user_custom_theme.sidebar_bg %}
        --sidebar-bg: {{ site.user_custom_theme.sidebar_bg }} !important;
        /* 사이드바 하단 테두리나 구분선 대응 */
        --sidebar-border-color: {{ site.user_custom_theme.sidebar_bg }} !important;
      {% endif %}

      {% if site.user_custom_theme.sidebar_text %}
        --sidebar-muted-color: {{ site.user_custom_theme.sidebar_text }} !important;
        --sidebar-active-color: {{ site.user_custom_theme.sidebar_active_color | default: '#00d2d3' }} !important;
        /* 사이드바 내 글자색 강제 적용 */
        --nav-cursor-color: {{ site.user_custom_theme.sidebar_active_color }} !important;
      {% endif %}
    }

    /* 3. Chirpy 테마의 특정 컴포넌트 강제 보정 */
    html[data-mode="light"] #sidebar {
      background-color: var(--sidebar-bg) !important;
    }

    html[data-mode="light"] #main-wrapper {
      background-color: var(--body-bg) !important;
    }

    /* 포스트 카드 목록이 배경과 구분되지 않게 하려면 border 제거 */
    html[data-mode="light"] .card {
      border: none !important;
      box-shadow: none !important;
    }
  </style>
{% endif %}

  {% include metadata-hook.html %}
</head>
